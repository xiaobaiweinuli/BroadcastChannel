# 消息链接修复说明

## 问题描述

在多频道模式下，RSS 和页面中的消息链接无法正确打开非第一个频道的消息。

例如：
- `https://tg.xingshuang.xyz/posts/18` ✅ 能打开（第一个频道的消息）
- `https://tg.xingshuang.xyz/posts/1733` ❌ 无法打开（其他频道的消息）

## 问题原因

1. 旧的链接格式 `/posts/{id}` 不包含频道信息
2. 系统只从第一个频道尝试获取消息
3. 如果消息不在第一个频道，就无法找到

## 解决方案

### 1. 新的链接格式

现在消息链接包含频道信息：

- 旧格式：`/posts/1733`
- 新格式：`/posts/CopyRightZGQInc/1733`

### 2. 兼容性处理

- 新链接：`/posts/{channel}/{id}` - 直接从指定频道获取消息
- 旧链接：`/posts/{id}` - 尝试从所有频道查找消息（向后兼容）

### 3. 修改的文件

1. **src/pages/posts/[channel]/[id].astro** - 新增路由，处理带频道的消息链接
2. **src/components/item.astro** - 修改链接生成逻辑，包含频道信息
3. **src/pages/rss.xml.js** - RSS 链接包含频道信息
4. **src/lib/telegram/index.js** - 优化单消息查找逻辑

## 效果

### RSS 链接示例

```xml
<!-- 第一个频道的消息 -->
<link>https://tg.xingshuang.xyz/posts/xingshuang_blog/18</link>

<!-- 其他频道的消息 -->
<link>https://tg.xingshuang.xyz/posts/CopyRightZGQInc/1733</link>
```

### 页面链接

所有消息链接现在都包含频道信息，确保能正确打开任何频道的消息。

## 向后兼容

旧的链接格式 `/posts/{id}` 仍然可以使用，系统会尝试从所有配置的频道中查找该消息。

## 测试建议

1. 访问主页，点击不同频道的消息链接
2. 检查 RSS 订阅中的链接是否正确
3. 测试旧链接是否仍然可用
4. 确认所有频道的消息都能正确显示
