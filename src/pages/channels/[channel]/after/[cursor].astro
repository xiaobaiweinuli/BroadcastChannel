---
import List from '../../../../components/list.astro'
import { getChannelInfo } from '../../../../lib/telegram'
import { getEnv } from '../../../../lib/env'

const { channel: channelName, cursor } = Astro.params

// Validate channel exists in CHANNELS config
const channelsEnv = getEnv(import.meta.env, Astro, 'CHANNELS')
const channels = channelsEnv
  ? channelsEnv
      .split(',')
      .map((c) => c.trim())
      .filter(Boolean)
  : []

if (!channels.includes(channelName)) {
  return Astro.redirect('/channels')
}

// Fetch channel data with pagination
const channel = await getChannelInfo(Astro, {
  singleChannel: channelName,
  after: cursor,
})

channel.seo = {
  title: channel.title,
  noindex: true,
}
---

<List channel={channel} baseUrl={`/channels/${channelName}`} />
